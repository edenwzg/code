管理端流程测试
================================================================================
- 商家注册
    - `首先需要商家关注童游的微信帐号,生成玩家`
- 创建商家
    - `商家名称设置`
    - `选择作为创建者的玩家`
    - `提升商家的玩家身份为创建者`
    - `绑定商家提供的收款帐号(默认为创建者的微信号)`
    - 设置账单日(账单日设置后不可修改)`
    - 设定分成比例(商家到账后做验证)`
    - `生成商家二维码`
- 创建经营者
    - `从玩家列表中选择一名玩家作为商家的经营者,在玩家信息中,玩家身份被提升`
    - 创建多个经营者`
    - 删除几个经营者`
- 创建设备
    - `创建产品`
    - `创建店面,绑定商家`
    - `创建设备,绑定产品, 绑定店面, 生成machineID(1000001781511171012098h571vjFnI1)`
    - 创建多个设备,分别设置不同的资费`
    - 删除几台设备,在管理端查看情况`
    - `关联设备,将machineID配置在客户端`
- 检测充值和扣费状态
    - 玩家充值
    - 商家设置充值赠送点券活动
    - 玩家再次充值
    - 在玩家充值页面查询玩家的充值记录`
    - 在商家端查看玩家的充值记录`
    - 在管理端查询充值记录`
- 模拟消费
    - 商家设置游戏资费`
    - 玩家通过扫描商家二维码充值`
    - 被动关注童游微信公众号`
    - 生成玩家二维码 o7r670zDkW0zMppqj1S7IpXhAkG81230`
    - 通过设备扫描玩家二维码进行扣费`
    - 扫码成功后进入游戏`
    - 在商家端查看玩家的消费记录`
    - 在管理端查询消费记录`
    - 在玩家端查看游戏的消费记录(结算信息)
- 分账和回款
    - 查看账单生成记录`
    - 查看公司账户的回款记录`
    - 查看商家的回款情况
- 成就管理 订购礼品 推送消息
    - 检测游戏成就的达成情况`
    - 商家订购了1款礼品`
    - 商家准备在次日做一个充值返现活动,在微信端展示`
- 开设分店 扩大规模 修改合作模式
    - 分店名称: 吉姆考拉高新区锦辉店`
    - 增加设备: 套索英雄团`
    - 经营者: 增加1名店长`
    - 分店合作模式改为: 不分成,手续费`
- 分店倒闭 总店转让 玩家退款
    - 改变一个商家的收款账户`
    - 玩家退款`
013
1000001791511340792707YJtFWi096I

1000001791511426278504DlbKwc0Hyj

1490303472@1490303472
510308
协议
================================================================================
- 设备登录
    http://games.dltongyou.com/tongyou/equipment/equipmentLogin.shtml?json={machineId :"1000001791511340792707YJtFWi096I"}
- 刷卡消费
    http://games.dltongyou.com/tongyou/equipment/equipmentPlayer.shtml?json={machineId%20:%20"1000001791511340792707YJtFWi096I",cardId:"o7r670zDkW0zMppqj1S7IpXhAkG81230",position:"0"}
- 发送心跳
    http://games.dltongyou.com/tongyou/equipment/equipmentisLogin.shtml?json={machineId :"1000001791511340792707YJtFWi096I"}
- 游戏结算
    http://games.dltongyou.com/tongyou/gameLog/insertGameLog.shtml?json={"machineId" :"1000001791511340792707YJtFWi096I","userCound":"1","startTime":"2017-11-24 11:32:12","endTime":"2017-11-24 11:36:23","userData":[{"cardId":"o7r670zDkW0zMppqj1S7IpXhAkG81230","point":"1010","gold":"1010","animals":{"ids":[1],"cnt":[3]},"huntingCnt":"8","huntingFail":"3","brokeRope":"7","miss":"2","overTurn":"10"}]}
================================================================================
- 设备登录
    http://games.dltongyou.com/tongyou/equipment/equipmentLogin.shtml?json={machineId :"1000001791511426278504DlbKwc0Hyj"}
- 刷卡消费
    http://games.dltongyou.com/tongyou/equipment/equipmentPlayer.shtml?json={machineId%20:%20"1000001791511426278504DlbKwc0Hyj",cardId:"o7r670zDkW0zMppqj1S7IpXhAkG81230",position:"0"}
- 发送心跳
    http://games.dltongyou.com/tongyou/equipment/equipmentisLogin.shtml?json={machineId :"1000001791511426278504DlbKwc0Hyj"}
- 游戏结算
    http://games.dltongyou.com/tongyou/gameLog/insertGameLog.shtml?json={"machineId" :"1000001791511426278504DlbKwc0Hyj","userCound":"1","startTime":"2017-11-24 12:32:12","endTime":"2017-11-24 12:36:23","userData":[{"cardId":"o7r670zDkW0zMppqj1S7IpXhAkG81230","point":"1010","gold":"1010","animals":{"ids":[1],"cnt":[3]},"huntingCnt":"8","huntingFail":"3","brokeRope":"7","miss":"2","overTurn":"10"}]}

200000072


100000184 商家
    300000010 店面
        400000013 产品
            500000024 1000001841511594225410HCcuyYeAMZ

商家:100000182:商家:王泽光
    店面:300000005:上海迪斯尼
        (游戏)产品:400000012:妙笔涂鸦+折叠卡纸
            设备:500000018:1000001821511502797067wittS5fVoG
        (游戏)产品:400000010:套索英雄团+礼品组合1
            设备:500000016:1000001821511502349707X4INTaQ8MZ
            设备:500000019:1000001821511502888957S7uBXgpi9m
    店面:300000008:加州迪斯尼
        (游戏)产品:400000011:套索英雄团+无礼品
            500000017:1000001821511502586910p2IBozk5p3


bug
================================================================================
- 2017-11-20
    - `管理端.商家管理.商家信息.资金流转:表单内容为"次日","9号和24号(每月两次)","10号(每月1次)"`
    - `管理端.玩家管理:细分玩家的身份为:"负责人","店员","管理员","玩家"`
    - `管理端.商家管理.商家信息:新增"收款人"字段,默认的收款账户为为"负责人"的微信账户`
    - `管理端.商家信息:可以改变一个商户的收款账户,通过填入一个玩家的ID来设置`
    - `管理端.玩家管理:线下充值和线上充值在页面上显示颠倒了`
    - `管理端:管理端的设备管理上增加machineID字段,用于和物理设备绑定`
    - `玩家端:当玩家扫描商家二维码,正确的流程应该是(扫码->充值页面->支付(被动关注)->弹出二维码页面)`
    - `玩家端:玩家扫描商家的二维码后,在玩家端应该保留该商家的付费入口.下次玩家可以直接点付费进行充值`
- 2017-11-21
    - `管理端.商家管理:最后一个商家删除后,要刷新一下页面才能消失`
    - `管理端.商家管理:中按照商家ID搜索功能未完成`
    - `管理端.玩家管理:以玩家ID进行搜索玩家昵称时显示"网络连接失败"`
    - `管理端.玩家管理:看不到玩家的充值记录,消费记录`
    - `管理端.玩家管理:按照玩家ID搜索不支持模糊查询`
    - `管理端.玩家管理.充值记录:资金流转状态和补发操作,现在没有意义.暂时先从页面上移除`
    - `管理端.店面管理:最后一个店面删除后,要刷新一下页面才能消失`
    - `管理端.设备管理:machineID在设备编辑界面也应该显示出来`
    - `管理端.礼品管理:礼品图标不做变形处理`
    - `玩家端:微信端商家活动展示列表为空白页`
    - `玩家端:玩家端首页商家卷展览的'－'号不好用`
    - `玩家端:玩家冻结后,在进入"我要玩游戏"和"玩家中心"没有提示.(弹窗不能关闭,只能返回)`
    - `商家端:商家端关闭线下充值入口,并弹出提示`
    - `商家端:设备名称沿用产品名称`
    - `商家端:玩家给商家充值后,在对应的商家端看不到充值记录`
    - `商家端.经营信息.查看详情:设备的消费总点券没有统计出来`
    - `商家端.经营信息.查看详情:店面的消费总点券没有统计出来`
    - `商家端.经营信息:消费总点券没有统计出来`
- 2017-11-22
    - `管理端.商家管理.经营者.创建经营者:"身份"为必填项`
    - `管理端.玩家管理:商家删除后客户的管理员身份没有被还原为玩家`
    - `管理端.礼品管理:礼品图标做等比缩放,不做变形处理`
    - `商家端.游戏设置:多个店的情况下,下面的设备显示不出来`
    - `商家端.玩家管理:很多玩家消失了比如'Eden'用户不见了`
    - `玩家端.充值确认对话框的商家名称显示不正确,(永远是大玩家)`
    - `玩家端:关注了两个商家,第二个商家没有显示出来`
    - `玩家端.经营者身份删除后,相应的微信端.还是能够进入之前的商家端页面`
    - `商家端:新建图文消息,用IOS 10.0版本选择本地照片,会出现图片不支持的问题`
- 2017-11-23
    - `管理端.商家管理.经营者:经营者创建后显示'此商家已经有该经营者了',需要手动刷新浏览器才能显示出来`
- 2017-11-24
    - `管理端.玩家管理.消费记录:消费店面统计成商家名了,应统计店面名`
    - `管理端.店面管理:店面列表中,有一条数据是没有ID,没有店面名称,没有所属商家的.`
    - `管理端.店面管理.店面修改:修改店面名称确定后，店面就自动删除了,但商家端.游戏设置中还能看到`
    - `管理端.设备管理.创建设备:设备创建后弹出machineId提示窗口.点击其他地方不可以关闭该窗口`
    - `管理端.设备管理.创建设备:machineId窗口异常关闭后,点击创建会创建出重复Id不同machineId的设备`
    - `管理端.设备管理.编辑设备:不可输入内容的页面控件修改.`
    - `管理端.设备管理.新增设备和编辑设备:增加一个输入框,用于编辑设备名称`
- 2017-11-26
    - `玩家(200000072):扫描二维码消费后没有生成消费记录,玩家端已扣款.(由于玩家没有结算)`
    - `商家(100000179):没有生成账单,但是收款账户有收到两笔回款.(由于商家已经删除)`
    - 管理端.商家管理.交易流水:收入显示不正确(应该按照1%来计算)
    - 管理端.商家管理.账单信息:账单分成付款金额计算不正确(按照玩家充值的金额进行分成)
    - 管理端.商家管理.店面信息:删除一个店面后页面不刷新.
    - 商家端.经营信息.查看详情:显示样式有问题:和日期重叠`
    - 管理端.礼品管理.礼品信息中没有包含没有产品id的信息`
    - 商家端:新建图文消息,添加第二章图片的时候,还是显示第一张图片'
    - 商家端.礼品管理.礼品编辑:点击页面空白地方,会打开选择图片对话框'
    - 商家端.消息管理:过期的消息状态列显示为"已过期"
    - 商家端.名字超长部分处理成...


- 后期修改内容
    - 商家删除需要家限制条件(如有未结清账单,不能删除).
    - 玩家没有结算要自动结算并生成游戏记录.
    - 管理端.玩家管理.没有地方查看玩家的剩余点券.
    - 管理端.设备管理.设备列表加逻辑删除
    - 商家端.看不到自己的商家名称
    - 商家端.进入每个子页面,点击页面面左上角的按钮时,是返回到上一级,而不是直接关闭,按钮也不是叉.



功能设计
================================================================================
- 礼品管理
    - 礼品与产品关联
    - 商家在添加设备后,通过设备关联的产品,自动拉取礼品的信息,
    - 要给不同的商家配置同一款游戏的不同的礼品方案,需要通过新增产品的方式实现(包括不提供礼品方案)
    - 商家端.商家管理.礼品信息:自动获取礼品列表,在页面上显示(去掉新增按钮)
    - 商家端.商家管理.礼品信息:"编辑"功能自动关联礼品管理的编辑礼品.
    - 商家端.商家管理.礼品信息:"删除"功能自动关联礼品管理的删除礼品.
    - 商家端.礼品管理:删除礼品功能使用逻辑删除.('禁用'按钮改为'删除')

- machineID
    - 设计原则
        - machineID不能重复
        - 商家ID要明码显示   
        - 不能被猜到生成算法   
        - 不能由一个machineID推演其它的machineID  
        - 玩家扫码后通过machineID关联商家,以支持后续的支付操作等.  
        - machineID不可刷    
    - 生成方法
        - 组成结构: 9位的商家ID + 加密字符.
        - 加密字符: 服务器时间戳 + 10位的随机码(取值范围0-9,a-z,A-Z). 
        - 存储方式: 9位的商家ID和加密字符分开存储
    - 生成途径
        - 通过管理端创建设备后生成(自动弹出提示窗).   
        - 创建设备成功后,弹出生成machineID提示窗,在提示窗口中可以查看并拷贝. 
        - 通过"编辑设备"可以查看该设备的machineID.
    - 存储位置
        - 客户端保存在配置文件中(人工手动操作)
        - 服务器通过管理端配置
    - 操作流程
        - 第一步: 创建商家
        - 第二步: 创建店面
        - 第三步: 创建设备, 生成machineID
        - 第四步: 将machineID拷贝到本地配置文件中(人工手动操作)
    - 验证流程
        - 截取前9位,与所有商家的ID进行对比,找到对应商家之后,再对比加密字符.
    - 异常处理
        - 如果machineID无法匹配或不存在,在客户端输出machineID异常消息,
        并显示MachineID码,同时打印到屏幕.
- 商家二维码
    - 规则设计
        - 通过扫描商家的二维码来绑定商家,支持后续的付款操作等等.
        - 通过扫描商家的二维码是实现关注童游公众号的一种途径.
        - 二维码的组成结构是: 童游公众号网址 + 商家的ID
        - 二维码可以(主要途径)通过管理端生成.
        - 商家二维码不可刷新.
    - 二维码生成的操作流程
        - 第一步: 在管理端已创建的商家管理模块中选择二维码页面
        - 第二步: 保存并打印二维码
        - 第三步: 将二维码随设备一起发送给商家,商家自行粘贴到设备上.
    - 扫码流程: 
        - 扫码后自动弹出充值页
        - 填写充值金额,点击充值后,自动跳转到支付页
        - 支付页面支付成功后,弹出付款成功页面,点击确认后会自动进入玩家二维码页.
            - 关注公众号选项勾选(默认是勾选的),点击"确定"会自动关注童游公众号.
            - 玩家手动将关注公众号选项取消勾选,将不会自动关注童游公众号.
        - 在二维码页面玩家可以通过设备扫玩家码进行游戏.
- 商家结算方式
    - 模式规则
        - 管理端.商家管理.商家信息:通过"结算方式"表单,设置结算方式,表单内容为:
            - 按充值结算:按照充值事件即时刷新
            - 按消费结算:消费信息30秒刷新1次
        - 管理端.商家管理:新增消费流水tab页面,统计玩家的消费信息
        - 管理端.商家管理.账单信息
            - 按充值结算:根据玩家的充值信息生成账单
            - 按消费结算:根据玩家爱的消费信息生成账单        
        - 商家创建后合作模式不可更改.(想要更改合作模式走商家销户流程)
        - 账单生成
            - 账单日当天的23点生成账单
            - 账单生成后次日10点向商家转款
            - 可结算金额达到1元以上才能生成账单.
            - 未满足生成条件的账单,累计到下次.
        - 账单信息表
            - 如果转款失败,在账单表上的"账单状态"根据微信支付的结果显示支付状态
            - "付款金额"列采用的单位改为(元)  
- 微信商户平台业务规则
    - 收款账户只能转到绑定的对公银行卡
    - 7天后结算,收取%1的手续费(游戏业务),自动收款


- 店面的转让

- 实例的删除
    - 删除商家后,其他相关信息的处理.
        - 商家删除后,客户的和商家相关的身份都删除,客户还原为玩家身份.
        - 在管理端的商家管理,屏蔽显示所有删除商家.
        - 如果商家有未出账单和未结账单,禁止删除
        - 已删除商家在玩家端不显示
        - 已删除商家管理者和创建者身份还原为玩家,同时他们的微信商家端也自然进不去了.
        - 在管理端的其他与删除商家相关的字段仍然要保留,不能丢连接关系.
        - 与该商家相关的店面,设备都要删除(同样也是逻辑删除).
    - 店面所属商家和设备所属店面, 在创建后不可编辑, 在删除后保留连接关系.
    - 已经被关联过的店面和设备,在任何情况下不能被再次关联,即使商家和店面被删除,也不能再次重复使用.
- 玩家退款
    - 管理端:每个商家需要一个手续费字段的设置(平时用不着,退款的时候会用到).
    - 退款手续费单独设置
- 充值未到账
    - 商家端.玩家管理:考虑增加一个微信账单页面,以此账单为依据作为玩家充值未到账的判断条件.
- 优化体验
    - 商家端.玩家管理:文字描述改为 "客户管理","客户详情","返回客户列表","客户ID","客户名称"